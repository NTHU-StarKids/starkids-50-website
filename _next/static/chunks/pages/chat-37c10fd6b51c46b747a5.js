(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{7484:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,r="millisecond",s="second",i="minute",a="hour",o="day",u="week",l="month",c="quarter",d="year",f="date",h="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},x=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},v={s:x,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),s=n%60;return(t<=0?"+":"-")+x(r,2,"0")+":"+x(s,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),s=t.clone().add(r,l),i=n-s<0,a=t.clone().add(r+(i?-1:1),l);return+(-(r+(n-s)/(i?s-a:a-s))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:d,w:u,d:o,D:f,h:a,m:i,s:s,ms:r,Q:c}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},w="en",y={};y[w]=g;var b=function(e){return e instanceof N},$=function(e,t,n){var r;if(!e)return w;if("string"==typeof e)y[e]&&(r=e),t&&(y[e]=t,r=e);else{var s=e.name;y[s]=e,r=s}return!n&&r&&(w=r),r||!n&&w},j=function(e,t){if(b(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new N(n)},S=v;S.l=$,S.i=b,S.w=function(e,t){return j(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var N=function(){function g(e){this.$L=$(e.locale,null,!0),this.parse(e)}var x=g.prototype;return x.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(S.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(m);if(r){var s=r[2]-1||0,i=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],s,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)):new Date(r[1],s,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},x.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},x.$utils=function(){return S},x.isValid=function(){return!(this.$d.toString()===h)},x.isSame=function(e,t){var n=j(e);return this.startOf(t)<=n&&n<=this.endOf(t)},x.isAfter=function(e,t){return j(e)<this.startOf(t)},x.isBefore=function(e,t){return this.endOf(t)<j(e)},x.$g=function(e,t,n){return S.u(e)?this[t]:this.set(n,e)},x.unix=function(){return Math.floor(this.valueOf()/1e3)},x.valueOf=function(){return this.$d.getTime()},x.startOf=function(e,t){var n=this,r=!!S.u(t)||t,c=S.p(e),h=function(e,t){var s=S.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?s:s.endOf(o)},m=function(e,t){return S.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},p=this.$W,g=this.$M,x=this.$D,v="set"+(this.$u?"UTC":"");switch(c){case d:return r?h(1,0):h(31,11);case l:return r?h(1,g):h(0,g+1);case u:var w=this.$locale().weekStart||0,y=(p<w?p+7:p)-w;return h(r?x-y:x+(6-y),g);case o:case f:return m(v+"Hours",0);case a:return m(v+"Minutes",1);case i:return m(v+"Seconds",2);case s:return m(v+"Milliseconds",3);default:return this.clone()}},x.endOf=function(e){return this.startOf(e,!1)},x.$set=function(e,t){var n,u=S.p(e),c="set"+(this.$u?"UTC":""),h=(n={},n[o]=c+"Date",n[f]=c+"Date",n[l]=c+"Month",n[d]=c+"FullYear",n[a]=c+"Hours",n[i]=c+"Minutes",n[s]=c+"Seconds",n[r]=c+"Milliseconds",n)[u],m=u===o?this.$D+(t-this.$W):t;if(u===l||u===d){var p=this.clone().set(f,1);p.$d[h](m),p.init(),this.$d=p.set(f,Math.min(this.$D,p.daysInMonth())).$d}else h&&this.$d[h](m);return this.init(),this},x.set=function(e,t){return this.clone().$set(e,t)},x.get=function(e){return this[S.p(e)]()},x.add=function(r,c){var f,h=this;r=Number(r);var m=S.p(c),p=function(e){var t=j(h);return S.w(t.date(t.date()+Math.round(e*r)),h)};if(m===l)return this.set(l,this.$M+r);if(m===d)return this.set(d,this.$y+r);if(m===o)return p(1);if(m===u)return p(7);var g=(f={},f[i]=t,f[a]=n,f[s]=e,f)[m]||1,x=this.$d.getTime()+r*g;return S.w(x,this)},x.subtract=function(e,t){return this.add(-1*e,t)},x.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var r=e||"YYYY-MM-DDTHH:mm:ssZ",s=S.z(this),i=this.$H,a=this.$m,o=this.$M,u=n.weekdays,l=n.months,c=function(e,n,s,i){return e&&(e[n]||e(t,r))||s[n].substr(0,i)},d=function(e){return S.s(i%12||12,e,"0")},f=n.meridiem||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r},m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:S.s(o+1,2,"0"),MMM:c(n.monthsShort,o,l,3),MMMM:c(l,o),D:this.$D,DD:S.s(this.$D,2,"0"),d:String(this.$W),dd:c(n.weekdaysMin,this.$W,u,2),ddd:c(n.weekdaysShort,this.$W,u,3),dddd:u[this.$W],H:String(i),HH:S.s(i,2,"0"),h:d(1),hh:d(2),a:f(i,a,!0),A:f(i,a,!1),m:String(a),mm:S.s(a,2,"0"),s:String(this.$s),ss:S.s(this.$s,2,"0"),SSS:S.s(this.$ms,3,"0"),Z:s};return r.replace(p,(function(e,t){return t||m[e]||s.replace(":","")}))},x.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},x.diff=function(r,f,h){var m,p=S.p(f),g=j(r),x=(g.utcOffset()-this.utcOffset())*t,v=this-g,w=S.m(this,g);return w=(m={},m[d]=w/12,m[l]=w,m[c]=w/3,m[u]=(v-x)/6048e5,m[o]=(v-x)/864e5,m[a]=v/n,m[i]=v/t,m[s]=v/e,m)[p]||v,h?w:S.a(w)},x.daysInMonth=function(){return this.endOf(l).$D},x.$locale=function(){return y[this.$L]},x.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=$(e,t,!0);return r&&(n.$L=r),n},x.clone=function(){return S.w(this.$d,this)},x.toDate=function(){return new Date(this.valueOf())},x.toJSON=function(){return this.isValid()?this.toISOString():null},x.toISOString=function(){return this.$d.toISOString()},x.toString=function(){return this.$d.toUTCString()},g}(),D=N.prototype;return j.prototype=D,[["$ms",r],["$s",s],["$m",i],["$H",a],["$W",o],["$M",l],["$y",d],["$D",f]].forEach((function(e){D[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),j.extend=function(e,t){return e.$i||(e(t,N,j),e.$i=!0),j},j.locale=$,j.isDayjs=b,j.unix=function(e){return j(1e3*e)},j.en=y[w],j.Ls=y,j.p={},j}()},4314:function(e,t,n){"use strict";n.d(t,{zG:function(){return d},P4:function(){return f},IU:function(){return h}});var r=n(266),s=n(809),i=n.n(s),a=n(9669),o=n.n(a),u=n(6264),l=o().create({baseURL:"https://starkids-50-nodejs.herokuapp.com/"}),c=function(){var e=(0,r.Z)(i().mark((function e(t){var n,r,s,a,o,c,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.url,r=t.method,s=void 0===r?"POST":r,a=t.body,o=u.decamelizeKeys(a),e.next=4,l({url:n,method:s,data:o});case 4:return c=e.sent,d=u.camelizeKeys(c.data),e.abrupt("return",d);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){return c({url:"/chats",method:"GET"})},f=function(e,t,n){return c({url:"/chats",method:"POST",body:{name:e,text:t,profile:n}})},h=function(e){return c({url:"/signup",method:"POST",body:e})}},8813:function(e,t,n){"use strict";var r=n(5893);t.Z=function(e){var t=e.text,n=e.className,s=t.split("\n");return(0,r.jsx)("span",{className:n,children:s.map((function(e,t){return t==s.length+1?(0,r.jsx)("span",{children:e},"text-".concat(t)):(0,r.jsxs)("span",{children:[e,(0,r.jsx)("br",{})]},"text-".concat(t))}))})}},2729:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var r=n(2809),s=n(266),i=n(809),a=n.n(i),o=n(7484),u=n.n(o),l=n(7294),c=n(7814),d=n(9398),f=n(4314),h=n(8315),m=n(5077),p=n(8813),g=n(6612),x=n(7687),v=n(8767),w=n(5893);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var b="profile-01",$=function(e){var t=JSON.parse(localStorage.getItem("chatIds"))||[];t.push(e);var n=Array.from(new Set(t));localStorage.setItem("chatIds",JSON.stringify(n))},j=function(e){var t=e.name,n=e.profileUrl,r=e.isSelf,s=e.sentAt,i=e.messages;return(0,w.jsxs)("div",{className:"flex w-full sm:w-5/6 md:w-4/5 lg:w-2/3 ".concat(r?"flex-row-reverse ml-auto":""),children:[(0,w.jsx)("div",{className:"w-8 md:w-12",children:(0,w.jsx)("div",{className:"relative w-8 md:w-12 h-8 md:h-12 rounded-full bg-center bg-cover",style:{backgroundImage:"url('".concat(n,"')")}})}),(0,w.jsx)("div",{className:"w-full text-left px-2 md:px-3",children:i.map((function(e,n){return(0,w.jsxs)("div",{className:"font-light",children:[0==n&&(r?(0,w.jsxs)("p",{className:"tracking-wide text-gray-50 leading-4 text-right cursor-default select-none",children:[(0,w.jsx)("span",{className:"mr-2 text-sm text-gray-200",children:u()(s).format("YYYY/MM/DD HH:mm")}),t]}):(0,w.jsxs)("p",{className:"tracking-wide text-gray-50 leading-4 cursor-default select-none",children:[t,(0,w.jsx)("span",{className:"ml-2 text-sm text-gray-200",children:u()(s).format("YYYY/MM/DD HH:mm")})]})),(0,w.jsx)("div",{className:"w-full flex ".concat(r?"justify-end":"justify-start"),children:(0,w.jsx)("div",{className:"mt-1 p-3 rounded-2xl tracking-wide ".concat(r?"bg-purple-600 text-white":"bg-white text-black"," ").concat(0==n?r?"rounded-tr-none":"rounded-tl-none":""),title:u()(s).format("YYYY/MM/DD HH:mm:ss"),children:(0,w.jsx)(p.Z,{text:e.text})})})]},"message-".concat(n))}))})]})},S=function(e){var t=e.disabled,n=e.messageGroups,i=e.refetchChats,o=(0,l.useState)(""),u=o[0],p=o[1],g=(0,l.useState)(""),v=g[0],S=g[1],N=(0,l.useState)(b),D=N[0],M=N[1],O=(0,l.useRef)(),k=(0,l.useRef)(),_=function(){var e=(0,s.Z)(a().mark((function e(){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||!v||!v.split(/\n|\r|\r\n/g).join("")){e.next=5;break}return e.next=3,(0,f.P4)(u||"\u533f\u540d",v,D);case 3:(n=e.sent)&&($(n.id),S(""),k.current.click(),O.current.focus(),i());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(e){t||"Enter"!==e.key||e.nativeEvent.isComposing||e.shiftKey||"ontouchstart"in window||navigator.maxTouchPoints>0||(_(),e.preventDefault())};return(0,l.useEffect)((function(){var e=localStorage.getItem("profile")||b,t=x.hm.findIndex((function(t){return t==e}));-1===t?localStorage.setItem("profile",b):M(x.hm[t]);var n=localStorage.getItem("chatNickname");n&&p(n)}),[]),(0,w.jsxs)(m.Z,{children:[(0,w.jsx)(h.H2,{className:"mb-10",children:"\u7559\u8a00\u677f"}),(0,w.jsxs)("div",{className:"relative",children:[(0,w.jsx)("div",{className:"absolute w-full -top-4 flex justify-center z-30",children:(0,w.jsx)("div",{className:"rounded-full bg-purple-500 h-8 px-4 py-2 text-base sm:text-lg leading-4 sm:leading-4 tracking-wider select-none",children:t?(0,w.jsx)(c.G,{className:"animate-spin h-4 mx-2 inline",icon:d.UO1}):"\u6e05\u5927\u5929\u658750\u5e74\u751f\u65e5\u5feb\u6a02 \ud83c\udf89"})}),(0,w.jsxs)("div",{className:"relative bg-gray-600 w-full h-116 sm:h-132 md:h-148 lg:h-164 xl:h-180 2xl:h-200 rounded-xl",children:[(0,w.jsxs)("div",{className:"absolute left-0 bottom-24 w-full h-92 sm:h-108 md:h-124 lg:h-140 xl:h-156 2xl:h-176 overflow-hidden",children:[(0,w.jsx)("div",{className:"absolute top-0 w-full h-full flex place-content-center transition-opacity duration-700 z-10 opacity-100 ".concat(t?"":"opacity-0"),children:(0,w.jsx)("svg",{className:"my-auto animate-spin h-10 w-10 rounded-full bg-transparent border-4 border-purple-500 border-opacity-90",viewBox:"0 0 24 24",style:{borderRightColor:"#F8F7FD"}})}),(0,w.jsx)("div",{className:"absolute w-full h-full z-20 transition-opacity duration-700 ".concat(t?"opacity-0":"opacity-100"),children:(0,w.jsx)("div",{className:"absolute bottom-0 w-full px-0.5 pt-2 pb-1 overflow-hidden",children:(0,w.jsx)("div",{className:"w-full max-h-88 sm:max-h-104 md:max-h-120 lg:max-h-136 xl:max-h-152 2xl:max-h-172 flex flex-col gap-4 px-2 pb-3 pt-6 lg:p-4 overflow-x-hidden overflow-y-scroll",children:n.map((function(e,t){return(0,w.jsx)(j,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e),"messageGroup-".concat(t))}))})})})]}),(0,w.jsx)("div",{className:"absolute left-0 bottom-0 w-full h-24 border-t-2 border-gray-500 px-2 md:px-4 py-2 select-none",children:(0,w.jsxs)("div",{className:"flex gap-1 h-full",children:[(0,w.jsx)("div",{className:"flex w-12 md:w-16 h-full",children:(0,w.jsx)("div",{className:"relative self-center w-12 md:w-16 h-12 md:h-16 rounded-full bg-center bg-cover ".concat(t?"cursor-not-allowed":"cursor-pointer"),style:{backgroundImage:"url('/img/profile/".concat(D,".png')")},onClick:function(){if(!t){var e=x.hm.findIndex((function(e){return e==D}));-1===e||e===x.hm.length-1?(M(x.hm[0]),localStorage.setItem("profile",x.hm[0])):(M(x.hm[e+1]),localStorage.setItem("profile",x.hm[e+1]))}},children:(0,w.jsx)("div",{className:"absolute right-0 bottom-0 w-6 h-6 rounded-full p-1 ".concat(t?"bg-gray-400":"bg-purple-500"),children:(0,w.jsx)(c.G,{icon:d.V$d})})})}),(0,w.jsxs)("div",{className:"w-full h-full flex flex-col gap-2 pl-1 md:pl-2",children:[(0,w.jsx)("div",{className:"w-full sm:w-1/2 h-9 bg-white rounded-full px-3.5 overflow-hidden",children:(0,w.jsx)("input",{type:"text",className:"form-input w-full h-full px-0 rounded placeholder-gray-400 text-black tracking-wider border-none outline-none focus:ring-0 focus:ring-transparent",name:"nickname",placeholder:"\u540d\u5b57/\u66b1\u7a31",disabled:t,autoComplete:"off",value:u,onChange:function(e){return t=e.target.value,p(t),void localStorage.setItem("chatNickname",t);var t}})}),(0,w.jsxs)("div",{className:"relative flex justify-between gap-1 w-full h-9 bg-white rounded-full pl-3.5 pr-0.5 overflow-hidden",children:[(0,w.jsx)("div",{className:"w-full no-scrollbar overflow-y-scroll",style:{marginTop:"0.4rem"},children:(0,w.jsx)("textarea",{className:"form-textarea w-full h-full p-0 rounded placeholder-gray-400 text-black tracking-wider border-none outline-none focus:ring-0 focus:ring-transparent",name:"message",autoFocus:!0,placeholder:"\u8f38\u5165\u8a0a\u606f",disabled:t,autoComplete:"off",value:v,onChange:function(e){return S(e.target.value)},onKeyDown:function(e){return I(e)},ref:O})}),(0,w.jsx)("div",{className:"flex w-8 h-9",children:(0,w.jsx)("div",{className:"w-8 h-8 self-center rounded-full p-1.5 pl-1 ".concat(!t&&v&&v.split(/\n|\r|\r\n/g).join("")?"bg-purple-500 cursor-pointer":"bg-gray-400 cursor-not-allowed"),onClick:_,children:(0,w.jsx)(c.G,{icon:d.XCy})})}),(0,w.jsx)("button",{className:"hidden invisable",ref:k})]})]})]})})]})]})]})};function N(){var e=(0,l.useState)([]),t=e[0],n=e[1],r=(0,v.useQuery)("chats",f.zG,{refetchInterval:3e4}),s=r.data,i=r.isFetched,a=r.refetch;return(0,l.useEffect)((function(){var e=function(){var e=JSON.parse(localStorage.getItem("chatIds"));return e||localStorage.setItem("chatIds",JSON.stringify([])),e||[]}(),t=function(t){return{id:t.id,name:t.name,profileUrl:"/img/profile/".concat(t.profile,".png"),isSelf:e.includes(t.id),sentAt:t.sentAt,messages:[{sentAt:t.sentAt,text:t.text}]}};if(i){var r,a=[];s.chats.forEach((function(n,i){if(0!=i){if(!(u()(n.sentAt).diff(u()(r.sentAt))<3e5&&(e.includes(n.id)&&e.includes(r.id)||!e.includes(n.id)&&!e.includes(r.id)&&n.name==r.name)))return a.push(r),r=t(n),void(i==s.chats.length-1&&a.push(r));var o={sentAt:n.sentAt,text:n.text};r.messages.push(o),i==s.chats.length-1&&a.push(r)}else r=t(n)})),n(a)}}),[i,s]),(0,w.jsx)(g.Z,{title:"\u7559\u8a00\u677f",children:(0,w.jsx)(S,{disabled:!i,messageGroups:t,refetchChats:a})})}},8984:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return n(2729)}])}},function(e){e.O(0,[774,523,74,612,888,179],(function(){return t=8984,e(e.s=t);var t}));var t=e.O();_N_E=t}]);